<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>لوحة الطلبات - برقر شوت</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body data-page="dashboard">
  <header><h1>لوحة الطلبات</h1></header>

  <main class="container">
    <section class="card">
      <h2>أوردرات جديدة</h2>
      <ul id="ordersList"></ul>
    </section>

    <section class="card">
      <h2>خيارات</h2>
      <button id="refreshBtn">تحديث</button>
      <button id="logoutBtn">تسجيل خروج</button>
    </section>
  </main>

  <footer>
    <a href="index.html">العودة للرئيسية</a>
  </footer>

  <script src="app.js"></script>
  <script>
    (function(){
      if (document.body.dataset.page !== 'dashboard') return;
      const logged = sessionStorage.getItem('loggedUser');
      if(!logged){ alert('سجل دخول أولاً'); location.href='login.html'; return; }

      function render(){
        const orders = getAllOrders();
        const ul = document.getElementById('ordersList');
        ul.innerHTML = '';
        if(orders.length === 0) ul.innerHTML = '<li>لا توجد طلبات حالياً</li>';
        orders.forEach(o=>{
          const li = document.createElement('li');
          li.innerHTML = `
            <div class="orderCard">
              <p><strong>#${o.id}</strong> — ${o.meal} — ${o.playerName} (${o.playerId})</p>
              <p>حالة: ${o.status} — ${new Date(o.time).toLocaleString()}</p>
              <button class="completeBtn" data-id="${o.id}">تم الاستلام</button>
            </div>
          `;
          ul.appendChild(li);
        });

        document.querySelectorAll('.completeBtn').forEach(b=>{
          b.addEventListener('click', ()=>{
            const id = b.dataset.id;
            markOrderCompleted(id);
            render();
          });
        });
      }

      document.getElementById('refreshBtn').addEventListener('click', render);
      document.getElementById('logoutBtn').addEventListener('click', ()=>{
        sessionStorage.removeItem('loggedUser');
        sessionStorage.removeItem('isAdmin');
        location.href='login.html';
      });

      // اعرض فوراً
      render();
      // تحديث تلقائي كل 5 ثواني
      setInterval(render, 5000);
    })();
  </script>
</body>
</html>
